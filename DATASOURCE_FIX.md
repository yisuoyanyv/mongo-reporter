# æ•°æ®æºç®¡ç†åŠŸèƒ½ä¿®å¤

## ğŸ¯ é—®é¢˜æè¿°
æ•°æ®æºç®¡ç†åŠŸèƒ½çœ‹ä¸åˆ°æ•°æ®ï¼Œé¡µé¢æ˜¾ç¤ºç©ºç™½æˆ–åªæœ‰ç¡¬ç¼–ç çš„æµ‹è¯•æ•°æ®ã€‚

## ğŸ” é—®é¢˜åˆ†æ

### 1. å‰ç«¯é—®é¢˜
- æ•°æ®æºç®¡ç†é¡µé¢ä½¿ç”¨äº†ç¡¬ç¼–ç çš„æµ‹è¯•æ•°æ®
- æ²¡æœ‰æ­£ç¡®è°ƒç”¨åç«¯API
- ç¼ºå°‘é”™è¯¯å¤„ç†å’ŒåŠ è½½çŠ¶æ€
- è¡¨å•éªŒè¯ä¸å®Œå–„

### 2. åç«¯é—®é¢˜
- `DataSourceController.list()` æ–¹æ³•åªè¿”å›é»˜è®¤æ•°æ®æº
- JWT tokenè§£æåŠŸèƒ½ä¸å®Œæ•´
- ç¼ºå°‘å®Œæ•´çš„CRUDæ“ä½œæ”¯æŒ

## âœ… è§£å†³æ–¹æ¡ˆ

### 1. ä¿®å¤å‰ç«¯æ•°æ®æºç®¡ç†é¡µé¢

**æ–‡ä»¶ï¼š** `frontend/src/views/DataSourceManager.vue`

#### ä¸»è¦æ”¹è¿›ï¼š
- âœ… ç§»é™¤ç¡¬ç¼–ç æ•°æ®ï¼Œæ”¹ä¸ºä»APIè·å–
- âœ… æ·»åŠ åŠ è½½çŠ¶æ€å’Œé”™è¯¯å¤„ç†
- âœ… å®Œå–„è¡¨å•éªŒè¯
- âœ… ä¼˜åŒ–ç”¨æˆ·ç•Œé¢å’Œäº¤äº’
- âœ… æ·»åŠ ç¡®è®¤åˆ é™¤åŠŸèƒ½

#### å…³é”®ä»£ç ï¼š
```javascript
const fetchDataSources = async () => {
  loading.value = true
  try {
    const response = await axios.get('/api/datasource')
    dataSources.value = response.data
    console.log('è·å–æ•°æ®æºæˆåŠŸ:', response.data)
  } catch (error) {
    console.error('è·å–æ•°æ®æºå¤±è´¥:', error)
    ElMessage.error('è·å–æ•°æ®æºå¤±è´¥')
  } finally {
    loading.value = false
  }
}
```

### 2. ä¿®å¤åç«¯æ•°æ®æºæ§åˆ¶å™¨

**æ–‡ä»¶ï¼š** `backend/src/main/java/com/mongo/reporter/backend/controller/DataSourceController.java`

#### ä¸»è¦æ”¹è¿›ï¼š
- âœ… ä¿®å¤ `list()` æ–¹æ³•è¿”å›æ‰€æœ‰æ•°æ®æº
- âœ… å®Œå–„JWT tokenè§£æ
- âœ… æ·»åŠ å®Œæ•´çš„CRUDæ“ä½œæ”¯æŒ
- âœ… æ”¹è¿›æƒé™æ§åˆ¶

#### å…³é”®ä»£ç ï¼š
```java
@GetMapping
public List<DataSource> list() {
    // è¿”å›æ‰€æœ‰æ•°æ®æºï¼ŒåŒ…æ‹¬é»˜è®¤çš„å’Œç”¨æˆ·åˆ›å»ºçš„
    return dataSourceRepository.findAll();
}

private String getUsernameFromToken(String auth) {
    if (auth == null || !auth.startsWith("Bearer ")) return null;
    String token = auth.substring(7);
    try {
        Claims claims = Jwts.parserBuilder().setSigningKey(key).build().parseClaimsJws(token).getBody();
        return claims.getSubject();
    } catch (Exception e) {
        return null;
    }
}
```

## ğŸ”§ åŠŸèƒ½ç‰¹æ€§

### 1. æ•°æ®æºåˆ—è¡¨
- æ˜¾ç¤ºæ‰€æœ‰æ•°æ®æºï¼ˆé»˜è®¤ + ç”¨æˆ·åˆ›å»ºï¼‰
- åŒ…å«åç§°ã€è¿æ¥å­—ç¬¦ä¸²ã€åˆ›å»ºè€…ä¿¡æ¯
- æ”¯æŒåŠ è½½çŠ¶æ€å’Œç©ºæ•°æ®æç¤º

### 2. æ·»åŠ æ•°æ®æº
- è¡¨å•éªŒè¯ï¼ˆåç§°å¿…å¡«ï¼Œè¿æ¥å­—ç¬¦ä¸²æ ¼å¼éªŒè¯ï¼‰
- è‡ªåŠ¨è®¾ç½®åˆ›å»ºè€…ä¿¡æ¯
- æˆåŠŸ/å¤±è´¥æç¤º

### 3. ç¼–è¾‘æ•°æ®æº
- é¢„å¡«å……ç°æœ‰æ•°æ®
- æƒé™æ§åˆ¶ï¼ˆåªèƒ½ç¼–è¾‘è‡ªå·±åˆ›å»ºçš„æ•°æ®æºï¼‰
- å®æ—¶æ›´æ–°åˆ—è¡¨

### 4. åˆ é™¤æ•°æ®æº
- ç¡®è®¤åˆ é™¤å¯¹è¯æ¡†
- æƒé™æ§åˆ¶ï¼ˆåªèƒ½åˆ é™¤è‡ªå·±åˆ›å»ºçš„æ•°æ®æºï¼‰
- é»˜è®¤æ•°æ®æºä¿æŠ¤

## ğŸ§ª æµ‹è¯•éªŒè¯

### 1. æµ‹è¯•é¡µé¢
è®¿é—®ï¼š`http://localhost:5173/test-datasource.html`

åŠŸèƒ½åŒ…æ‹¬ï¼š
- âœ… æ•°æ®æºAPIæµ‹è¯•
- âœ… æ·»åŠ æ•°æ®æºæµ‹è¯•
- âœ… æ•°æ®æºåˆ—è¡¨æ˜¾ç¤º
- âœ… æ‰‹åŠ¨æ·»åŠ æ•°æ®æº

### 2. ä¸»åº”ç”¨æµ‹è¯•
è®¿é—®ï¼š`http://localhost:5173/datasources`

æ£€æŸ¥ï¼š
- æ•°æ®æºåˆ—è¡¨æ˜¯å¦æ­£ç¡®æ˜¾ç¤º
- æ·»åŠ /ç¼–è¾‘/åˆ é™¤åŠŸèƒ½æ˜¯å¦æ­£å¸¸
- è¡¨å•éªŒè¯æ˜¯å¦æœ‰æ•ˆ
- é”™è¯¯å¤„ç†æ˜¯å¦å®Œå–„

## ğŸ“‹ APIç«¯ç‚¹

### è·å–æ•°æ®æºåˆ—è¡¨
```
GET /api/datasource
Authorization: Bearer <token>
```

### æ·»åŠ æ•°æ®æº
```
POST /api/datasource
Authorization: Bearer <token>
Content-Type: application/json

{
  "name": "æ•°æ®æºåç§°",
  "uri": "mongodb://localhost:27017/database"
}
```

### æ›´æ–°æ•°æ®æº
```
PUT /api/datasource/{id}
Authorization: Bearer <token>
Content-Type: application/json

{
  "name": "æ–°åç§°",
  "uri": "mongodb://localhost:27017/newdb"
}
```

### åˆ é™¤æ•°æ®æº
```
DELETE /api/datasource/{id}
Authorization: Bearer <token>
```

## ğŸ“Š æ•°æ®æ¨¡å‹

### DataSourceå®ä½“
```java
{
  "id": "æ•°æ®æºID",
  "name": "æ•°æ®æºåç§°",
  "uri": "MongoDBè¿æ¥å­—ç¬¦ä¸²",
  "owner": "åˆ›å»ºè€…ç”¨æˆ·å",
  "default": true/false
}
```

## ğŸ‰ ä¿®å¤æ•ˆæœ

### ä¿®å¤å‰
- âŒ é¡µé¢æ˜¾ç¤ºç¡¬ç¼–ç æµ‹è¯•æ•°æ®
- âŒ æ— æ³•ä¸åç«¯APIé€šä¿¡
- âŒ ç¼ºå°‘é”™è¯¯å¤„ç†
- âŒ åŠŸèƒ½ä¸å®Œæ•´

### ä¿®å¤å
- âœ… æ­£ç¡®æ˜¾ç¤ºåç«¯æ•°æ®
- âœ… å®Œæ•´çš„CRUDæ“ä½œ
- âœ… å®Œå–„çš„é”™è¯¯å¤„ç†
- âœ… è‰¯å¥½çš„ç”¨æˆ·ä½“éªŒ

## ğŸš€ ä½¿ç”¨æŒ‡å—

1. **æŸ¥çœ‹æ•°æ®æº**ï¼šè®¿é—®æ•°æ®æºç®¡ç†é¡µé¢ï¼Œè‡ªåŠ¨åŠ è½½æ‰€æœ‰æ•°æ®æº
2. **æ·»åŠ æ•°æ®æº**ï¼šç‚¹å‡»"æ–°å¢æ•°æ®æº"æŒ‰é’®ï¼Œå¡«å†™ä¿¡æ¯å¹¶ä¿å­˜
3. **ç¼–è¾‘æ•°æ®æº**ï¼šç‚¹å‡»æ•°æ®æºè¡Œçš„"ç¼–è¾‘"æŒ‰é’®
4. **åˆ é™¤æ•°æ®æº**ï¼šç‚¹å‡»æ•°æ®æºè¡Œçš„"åˆ é™¤"æŒ‰é’®ï¼Œç¡®è®¤åˆ é™¤

---

**æ•°æ®æºç®¡ç†åŠŸèƒ½ä¿®å¤å®Œæˆï¼ç°åœ¨å¯ä»¥æ­£å¸¸ç®¡ç†æ•°æ®æºäº†ï¼** ğŸš€ 